#!/usr/bin/env python
import os
import logging
import socket


logging.basicConfig()
LOGGER = logging.getLogger("admin-send")
LOGGER.setLevel(logging.INFO)
START_USER = os.getenv('FOR_USER') or os.getenv('USER')
_SOCKET_PATH = f"/home/{START_USER}/.config/Hawa/sockets"
_SOCKET_SERVER_TO_ADMIN = f"{_SOCKET_PATH}/server-to-admin"


def main():
    LOGGER.info("Starting receiver loop")
    try:
        connection = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)
        connection.connect(_SOCKET_SERVER_TO_ADMIN)
    except:
        LOGGER.exception("Connection error! Is the broadcast server running?")
        return

    try:
        while True:
            line = connection.recv(1024).decode("utf-8")
            if line:
                LOGGER.info(f">>> Received: {line.strip()}")
    except BrokenPipeError:
        pass
    except Exception as e:
        LOGGER.exception("Error on command reception!")


if __name__ == "__main__":
    main()
